<html>
<head>
	<link href='http://fonts.googleapis.com/css?family=Slabo+27px' rel='stylesheet' type='text/css'>
    <!-- Load the d3 library. -->
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <style>
        /* put a border around the svg element so we can see the coordinate system better. */
        body { font-family: "Open Sans"; } 
        div { margin: 30px; }
        h2, h3 { color: black; }
        /*svg { border: solid black 1px;}*/
        /* The default styles for axis elements stink. What should they be? */
        .axis path {}
        .axis line {}
    </style>
</head>

 <!-- Things to do: 
 1) Change jsonData to read actual data file
 2) Uncomment color in path declaration once data is inputted and comment old color assignment
 3) Create Legend. You can ignore my code and here is a helpful link: http://stackoverflow.com/questions/13573771/adding-a-chart-legend-in-d3
 4) Design Doc-->
    
<body>

<h2 style="font-family: 'Slabo 27px' serif'" align="center">San Fransisco Bay Area Bike Share Usage</h2>
<h3 style="font-family: 'Slabo 27px' serif'" align="center">August 2013 - August 2014</h3>

<div id="canvas" align="center"></div>

<script>
// Dimensions of sunburst
var width = 1000;
var height = 1000;
var radius = Math.min(width, height) / 4;
var onedayangle = 2*Math.PI/365.0;
var halfdayangle= Math.PI/365.0;
var total=100;

//var jsonData = [{"total" : 40},{"total" : 100},{"total" : 60},{"total" : 20},{"total" : 90} ];

var svg = d3.select("#canvas").append("svg")
    .attr("width", width)
    .attr("height", height)
    .attr("display","block")
    .append("g")
    .attr("transform", "translate(" + width / 2 + "," + height * .52 + ")");
//center the circle to the new origin (0,0)
    
//pattern fill for circle
var pattern = svg
    .append("defs")

    .append("pattern").attr("id", "pattern")
    .attr("patternUnits", "objectBoundingBox").attr("height","1").attr("width","1")
    .attr("viewBox", "0 0 1 1").attr("preserveAspectRatio","xMidYMid slice")

    .append("image")
    .attr("height","1").attr("width","1")
    .attr("preserveAspectRatio","xMidYMid slice")
    .attr("xlink:href", "biker.jpg")

//center circle
var circle = svg
    .append("circle")
    .attr("id", "circ")
    .attr("cx", 0)
    .attr("cy", 0)
    .attr("r", radius)
    .attr("fill", "url(#pattern)")
    .style("fill-opacity", 0.9)
    .style("border", "");

//top right label
var fall = svg.append("text")
    .style("font-family", "'Slabo 27px' serif'")
    .style("font-size","40px")
    .attr("x", 300)
    .attr("y", -350)
    .text("Fall")
    .attr("text-anchor", "middle")
    .attr("fill", "red");    

//bottom right label
var winter = svg.append("text")
    .style("font-size", "40px")
    .style("font-family", "'Slabo 27px' serif'")
    .attr("x", 325)
    .attr("y", 350)
    .text("Winter")
    .attr("text-anchor", "middle")
    .attr("fill", "blue"); 

//bottom left label
var Summer = svg.append("text")
    .style("font-size", "40px")
    .style("font-family", "'Slabo 27px' serif'")
    .attr("x", -325)
    .attr("y", 350)
    .text("Summer")
    .attr("text-anchor", "middle")
    .attr("fill", "green");

//top left label
var Spring = svg.append("text")
    .style("font-size", "40px")
    .style("font-family", "'Slabo 27px' serif'")
    .attr("x", -300)
    .attr("y", -350)
    .text("Spring")
    .attr("text-anchor", "middle")
    .attr("fill", "#FFCC00");
    

var bikeData;
    
d3.json("ordered_data.json", function(error, data) {
    bikeData = data;    

    //find height axis max
    var maxHeight = d3.max(bikeData, 
	   function (d) {
		  return d.Total;
	   });
    // number of ticks
    var numTicks = 5;

    var tickIncrements = [];
    for (var i=0; i<numTicks; i++) {
        tickIncrements[i] = (i+1)*(maxHeight/numTicks);
    }
    
    //var yScale = d3.scale.linear().domain([0, maxHeight]).range([0, maxHeight]);

    var circleTick1 = svg.append("circle").attr("id", "circleTick1")
    .attr("cx","0").attr("cy","0")
    .attr("r", (radius+(.1*tickIncrements[0])))
    .attr("fill","none")
    .attr("stroke","black")
    .attr("stroke-width",".5");
    
    var circleTick2 = svg.append("circle").attr("id", "circleTick2")
    .attr("cx","0").attr("cy","0")
    .attr("r", (radius+(.1*tickIncrements[1])))
    .attr("fill","none")
    .attr("stroke","black")
    .attr("stroke-width",".5");
    
    var circleTick3 = svg.append("circle").attr("id", "circleTick3")
    .attr("cx","0").attr("cy","0")
    .attr("r", (radius+(.1*tickIncrements[2])))
    .attr("fill","none")
    .attr("stroke","black")
    .attr("stroke-width",".5");
    
    var circleTick4 = svg.append("circle").attr("id", "circleTick4")
    .attr("cx","0").attr("cy","0")
    .attr("r", (radius+(.1*tickIncrements[3])))
    .attr("fill","none")
    .attr("stroke","black")
    .attr("stroke-width",".5");
    
    var circleTick5 = svg.append("circle").attr("id", "circleTick5")
    .attr("cx","0").attr("cy","0")
    .attr("r", (radius+(.1*tickIncrements[4])))
    .attr("fill","none")
    .attr("stroke","black")
    .attr("stroke-width",".5");
    
    
    
 
/* ATTEMP TO CREATE CIRCULAR TICK MARKS USING http://kreese.net/blog/2012/08/26/d3-js-creating-a-polar-area-diagram-radial-bar-chart/

    //padding
    var padding = {
        top: 25,
        right: 25,
        bottom: 25,
        left: 25
    };

    circle constraining dimension
    var heightCircleConstraint = height - padding.top - padding.bottom;
    var widthCircleConstraint = width - padding.left - padding.right;
    var circleConstraint = d3.min([heightCircleConstraint, widthCircleConstraint]);
    
//function for calculating the radius of a point from the center circle's radius
    var axisRadius = d3.scale.linear().domain([0, maxHeight])
        .range([0, (circleConstraint / 2)]);
    var radiusLength = radius + axisRadius(maxHeight);
    
//adding circular ticks
    svg.selectAll("#circle-ticks").remove();
    
    var circleAxes = svg.selectAll("#circle-ticks")
      .data(maxHeight/5)
      .enter().append("g")
      .attr("id", "circle-ticks");
    
    circleAxes.append("circle")
      .attr("r", function (d, i) { return radius(d); })
      .attr("id", "circle-tick")
      .style("stroke", "black")
      .style("fill", "none");
 
    circleAxes.append("text")
      .attr("text-anchor", "left")
      .attr("dy", function (d) { return -1 * radius(d); })
      .text("TEST");
*/
    

//create arc to represent the bar for each day's bike usage
var arc = d3.svg.arc()
    .startAngle(function(d, i) {return (i*onedayangle)-halfdayangle;})
    .endAngle(function(d, i) {return (i*onedayangle)+halfdayangle;})
    .innerRadius(function(d) {return radius;})
    .outerRadius(function(d) {return (.1*d.Total)+radius;});
 
 
//create the actual bars from data
var path = svg.selectAll("path")
    .data(bikeData)
    .enter()
    .append("path")
    .attr("d", arc)
    .style("stroke", "black")
    .attr("stroke-width",".5")
    .style("fill", function(d) {return d.Color});
    
});
</script>


</body>
</html>
